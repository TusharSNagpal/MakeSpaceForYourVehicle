---
- name: Kubernetes Copy using Ansible
  hosts: one
  tasks:
    - name: kubernetes copy
      become: true
      copy:
        src: ./kubernetes
        dest: ./
        owner: ansible_usr
        group: ansible_usr
        mode: 0644
    - name: Minikube
      command: minikube start
    - name: Apply backend secret file
      command: kubectl apply -f kubernetes/msfyv-backend-secret.yaml
    - name: Apply backend
      command: kubectl apply -f kubernetes/msfyv-backend.yaml
    - name: Service
      command: minikube service msfyv-backend-service
    - name: Port Forwarding Backend
      command: "kubectl port-forward --address localhost,{{ansible_ssh_host}} service/msfyv-backend-service 5001:5001"